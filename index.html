<!DOCTYPE html>
<html>

<head>
  <title>Simple React App</title>
</head>

<body>

  <div id="root"></div>

  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@6.26.0/babel.min.js"></script>
  <script>window.react = React;</script>
  <script src="dist/statsig-react.min.js"></script>
  <script src="dist/statsig-js-local-eval.min.js"></script>
  <script src="dist/statsig-js-remote-eval.min.js"></script>
  <script src="dist/statsig-sha256.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const { StatsigProvider, StatsigRemoteEvalClient, StatsigLocalEvalClient, useGate, useClientLoadingStatus } = __STATSIG__;

    const remoteEvalClient = new StatsigRemoteEvalClient(
      'client-wlH3WMkysINMhMU8VrNBkbjrEr2JQrqgxKwDPOUosJK',
    );

    const localEvalClient = new StatsigLocalEvalClient(
      'client-wlH3WMkysINMhMU8VrNBkbjrEr2JQrqgxKwDPOUosJK',
    )

    const user = { userID: 'a-user', email: "jkw@statsig.com", custom: { level: 9 } }

    function Content(props) {
      const { value: remoteEvalValue } = useGate(props.name);
      const { value: localEvalValue } = useGate(props.name, { localEvalUser: user });
      return <div >
        {props.name}
        <div style={{ color: remoteEvalValue ? "green" : "red" }}>- (Remote): {remoteEvalValue ? "Pass" : "Fail"}</div>
        <div style={{ color: localEvalValue ? "green" : "red" }}>- (Local): {localEvalValue ? "Pass" : "Fail"}</div>
        <br />
      </div>;
    }

    function App() {
      const [count, setCount] = useState(0);

      const [version, setVersion] = useState(0)

      useEffect(() => {
        remoteEvalClient.initialize(user).then(() => {
          setVersion((v) => v + 1)
        });
        localEvalClient.initialize().then(() => {
          setVersion((v) => v + 1)
        });
      }, [remoteEvalClient])

      return (
        <div>
          <div>Remote: {remoteEvalClient.loadingStatus}</div>
          <div>Local: {localEvalClient.loadingStatus}</div>
          <br />
          <StatsigProvider remoteEvalClient={remoteEvalClient} localEvalClient={localEvalClient}>
            {
              localEvalClient.n.values && localEvalClient.n.values.feature_gates.map((gate) => {
                if (gate.entity !== 'feature_gate') {
                  return null;
                }

                return <Content name={gate.name} />
              })
            }
          </StatsigProvider>

        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>

</body>

</html>